{% extends "crm/base.html" %}

{% block sub_title %}
  {% if is_home %}My{% endif %}
  My Tickets
{% endblock sub_title %}

{% block sub_heading %}
  {% if is_home %}My{% endif %}
  Tickets
{% endblock sub_heading %}

{% block content %}
  {% include 'crm/_menu.html' %}
  <div class="pure-g">
    <div class="pure-u-1">
      <div class="l-box">
        <table class="pure-table pure-table-bordered">
          <thead>
            <tr>
              {% if user.is_staff %}
                <th>Contact</th>
              {% endif %}
              <th>Ticket</th>
              <th>Priority</th>
            </tr>
          </thead>
          <tbody>
            {% for ticket in ticket_list %}
              <tr valign="top">
                {% if user.is_staff %}
                  <td>
                    <a href="{% url 'crm.contact.detail' ticket.contact.slug %}">
                      {{ ticket.contact.name }}
                    </a>
                  </td>
                {% endif %}
                <td>
                  <a href="{% url 'crm.ticket.detail' ticket.pk %}">
                    <strong>{{ ticket.title }}</strong>
                  </a>
                  {% if ticket.user_assigned and not is_home %}
                    <small>{{ ticket.user_assigned }}</small>
                  {% endif %}
                  {% if ticket.description %}
                    <br />
                    {{ ticket.description|urlize|linebreaksbr }}
                  {% endif %}
                </td>
                <td>
                  {% if ticket.priority.level %}
                    {{ ticket.priority.name }}
                  {% endif %}
                  {% if ticket.due %}
                    <small>due {{ ticket.due|date:"d/m/Y" }}</small>
                  {% endif %}
                  <small>created {{ ticket.created|date:"d/m/Y" }}</small>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
  {% include 'crm/_menu.html' %}
{% endblock content %}
